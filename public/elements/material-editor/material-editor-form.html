<dom-module id="material-editor-form">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <h4 class="page-header">Edit Material</h4>

    <div class="form-horizontal">
      <div class="form-group">
        <label for="nameInput" class="col-sm-2 control-label">Name</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" id="nameInput" placeholder="Material Name">
        </div>
      </div>

      <div class="form-group">
        <label for="nameInput" class="col-sm-2 control-label">Description</label>
        <div class="col-sm-10">
          <textarea id="descriptionInput" class="form-control" on-input="onDescriptionInput"></textarea>
        </div>
      </div>

      <div class="form-group" id="priceGroup">
        <label for="priceInput" class="col-sm-2 control-label" id="priceLabel">Price</label>
        <div class="col-sm-10">
          <input type="number" id="priceInput" class="form-control" on-input="onPriceInput"/>
        </div>
      </div>

      <div class="form-group" id="unitsGroup">
        <label for="unitsInput" class="col-sm-2 control-label">Units</label>
        <div class="col-sm-10">
          <div class="layout horizontal center">
            <div>us$/</div>
            <div class="flex">
              <budget-unit-selector id="unitsInput" on-units-change="editUnits" block></budget-unit-selector>
            </div>
          </div>

          <div id="unitsInputMsg"></div>
        </div>
      </div>

      <div class="form-group" id="complexGroup">
        <label class="col-sm-2 control-label"><i class="fa fa-cubes"></i></label>
        <div class="col-sm-10">
          <div class="checkbox">
            <label>
              <input type="checkbox" id="isComplexInput" on-click="toggleComplex"> Is complex material
            </label>
          </div>
          <div class="help-block">This material requires other materials.</div>

          <div id="complexPanel">
            <div id="materialsList"></div>
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="nameInput" class="col-sm-2 control-label"><i class="fa fa-shield"></i> Authority</label>
        <div class="col-sm-10">
          <budget-authority-selector id="authority" on-authority-select="onAuthoritySelect"></budget-authority-selector>
        </div>
      </div>

      <div class="form-group">
        <label for="locationInput" class="col-sm-2 control-label"><i class="fa fa-map-marker"></i> Location</label>
        <div class="col-sm-10">
          <budget-location-selector id="locationInput"></budget-location-selector>
        </div>
      </div>

      <div class="form-group">
        <label for="yearInput" class="col-sm-2 control-label"><i class="fa fa-hourglass-o"></i> Year</label>
        <div class="col-sm-10">
          <input type="number" id="yearInput" class="form-control"/>
        </div>
      </div>

      <div class="form-group">
        <label for="sourceInput" class="col-sm-2 control-label"><i class="fa fa-book"></i> Source</label>
        <div class="col-sm-10">
          <budget-markdown-input id="sourceInput"></budget-markdown-input>
          <div class="help-block">Add any source (where the data came from) information for this material.
            <a href="https://help.github.com/articles/markdown-basics/" target="_blank">Markdown</a>
             is encouraged.  External links are encouraged.
          </div>
        </div>
      </div>

      <div class="form-group" id="classGroup">
        <label for="optionInput" class="col-sm-2 control-label">Class</label>
        <div class="col-sm-10">
          <budget-class-selector id="classInput"></budget-class-selector>
        </div>
      </div>

    </div> <!-- end form -->

  </template>
  <script>
    Polymer({
      is: 'material-editor-form',

      ready : function() {
        this.requirePopup = document.querySelector('material-editor-new-required');
      },

      edit : function(material) {
        console.log(material);
        this.material = material;

        this.renderComplex();
        if( this.material.type === 'complex' ) {
          this.renderMaterials();
        }
      },

      toggleComplex : function() {
        if( this.material.type === 'complex' ) {
          this.material.type = 'simple';
        } else {
          this.material.type = 'complex';
          this.renderMaterials();
        }
        this.renderComplex();
      },

      renderMaterials : function() {
        var html = '';

        html += '<h5>Required Materials <a class="btn btn-link btn-lg" required><i class="fa fa-plus"></i></a></h5>';

        if( this.material.materials ) {
          html += '<ul class="list-group">';
          for( var name in this.material.materials ) {
            var m = this.material.materials[name];

            if( this.material.unique && this.material.unique[name] ) {
              var u = this.material.unique[name];

              html +=
                '<li class="list-group-item">'+
                    '<span class="label label-warning pull-right">Unique</span>'+
                    '<a class="btn btn-link"><i class="fa fa-trash"></i></a> '+
                    '<b>'+name+'</b> '+
                    m.amount+m.units+' @ <span class="text text-success">$'+u.price+'</span>';
                '</li>';

            } else {
              html +=
                '<li class="list-group-item">'+
                    '<a class="btn btn-link"><i class="fa fa-trash"></i></a> '+
                    '<b>'+name+'</b> '+
                    m.amount+m.units+
                '</li>';
            }
          }
          html += '</ul>';

          if( Object.keys(this.material.materials).length === 0 ) {
            html += 'None';
          }
        } else {
          html += 'None';
        }

        this.$.materialsList.innerHTML = html;

        $(this.$.materialsList)
          .find('a[required]')
          .on('click', function(){
            this.requirePopup.create();
          }.bind(this));
      },

      renderComplex : function() {
        if( this.material.type !== 'complex' ) {
          this.$.priceGroup.style.display = 'block';
          this.$.isComplexInput.checked = false;
          this.$.complexPanel.style.display = 'none';
        } else {
          this.$.priceGroup.style.display = 'none';
          this.$.isComplexInput.checked = true;
          this.$.complexPanel.style.display = 'block';
        }
      }
    });
  </script>
</dom-module>
