<dom-module id="budget-authority-selector">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <select id="selector" class="form-control" on-input="onInput"></select>
    <div class="help-block" id="noUser" style="display:none">You must login to update an authority</div>

  </template>
  <script>
    Polymer({
      is: 'budget-authority-selector',

      properties : {
        default : {
          type : String,
          observer : 'defaultObserver'
        },
        value : {
          type : String,
          observer : 'valueObserver'
        }
      },

      attached : function() {
        if( !ExpressAuth.user ) {
          this.$.selector.setAttribute('disabled', 'disabled');
          this.$.noUser.style.display = 'block';
          return;
        }

        var html = '<option value=""></option>';
        for( var i = 0; i < ExpressAuth.user.authorities.length; i++ ) {
          var auth = ExpressAuth.user.authorities[i];
          html += '<option value="'+auth+'">'+auth+'</option>';
        }
        html += '<option value="'+ExpressAuth.user.username+'">'+ExpressAuth.user.username+'</option>';
        this.$.selector.innerHTML = html;
      },

      onInput : function() {
        this.value = this.$.selector.value;
        this.fire('authority-select');
      },

      valueObserver : function(value) {
        if( !ExpressAuth.user ) {
          this.$.selector.innerHTML = '<option value="'+value+'">'+value+'</option>';
        } else {
          this.$.selector.value = value;
        }
      },

      defaultObserver : function() {
        if( !ExpressAuth.user ) return;

        this.$.selector.value = this.default;
        $(this.$.selector)
          .find('[value="'+this.default+'"]')
          .html(this.default+' (Current)');

        this.value = this.default;
      }

    });
  </script>
</dom-module>
