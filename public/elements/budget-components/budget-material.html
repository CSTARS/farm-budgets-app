<dom-module id="budget-material">
  <style>
    :host {
      display: inline-block;
    }
    #label:hover {
      color: #2196f3;
    }
  </style>

  <template>
    <div id="label" style="cursor:pointer" on-click="toggle"><b><i class="fa fa-cube"></i> <span id="nameLabel"></span></b></div>
    <div id="error" class="text text-danger"></div>
    <div id="price" style="white-space: nowrap">
      <div id="forLabel"></div>
      <span id="priceLabel"></span>
      <span id="unitLabel"></span>
      <a class="btn btn-link" id="edit"><i class="fa fa-edit"></i></a>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is : 'budget-material',

    properties : {
      material : {
        type : String,
        observer : 'render'
      },
      showPrice : {
        type : Boolean,
        observer : 'render',
        value : false
      }
    },

    attached : function() {
      this.render();
    },

    render : function(material) {
      this.updatePrice();

      this.showError();

      if( typeof material == 'string' ) this.material = material;
      if( !this.material ) return;

      this.$.nameLabel.innerHTML = this.material.replace(/.*--/, '');

      if( this.material.indexOf('--') > -1 ) {
        this.$.forLabel.innerHTML = '(for '+this.material.split('--')[0]+')';
      } else {
        this.$.forLabel.innerHTML = '';
      }

      var m = FB.materialController.get(this.material);
      if( m.error ) return this.showError(m);

      if( m.fixed ) {
        this.$.edit.style.display = 'none';
      } else {
        this.$.edit.style.display = 'inline-block';
        this.$.edit.href = '#budget/materials/'+this.material;
      }


      // TODO: don't think this is the best place for this error checkError
      // but at least we are getting it on screen
      if( m.price === undefined ) {
        return this.showError({message: 'No price set for this material'});
      }

      this.$.priceLabel.innerHTML = m.price;
      this.$.unitLabel.innerHTML = FB.units.getLabel(m.units, true);
      //this.data.materials[material].price.toFixed(2)
    },

    showError : function(err) {
      if( !err ) {
        this.$.error.style.display = 'none';
        return;
      }

      this.$.error.style.display = 'block';
      this.$.error.innerHTML = err.message;
    },

    toggle : function() {
      this.showPrice = !this.showPrice;
      this.updatePrice();
    },

    updatePrice : function() {
      if( this.showPrice ) this.$.price.style.display = 'block';
      else this.$.price.style.display = 'none';
    }
  });
</script>
