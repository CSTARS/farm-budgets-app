<link rel="import" href="../setup/budget-setup-authorities.html" />
<link rel="import" href="../setup/budget-setup-account.html" />

<dom-module id="budget-section-setup">
  <style>
    :host {
      display: block;
      padding-top: 25px;
    }
    .card {
      padding: 15px;
      margin: 15px;
      box-shadow: 0 0 8px #ccc;
    }
    @media(max-width: 768px) {
      .card {
        padding: 5px;
        margin: 5px 0px;
      }
    }
  </style>
  <template>

    <div id="noAccess" style="text-align center">
      <a class="btn btn-default btn-lg" href="/prototype/login.html">Login</a>

      <div class="well">
        You must first login so you can edit and save budgets.
      </div>

    </div>

    <div class="row" id="hasAccess">
      <div class="col-md-4">
        <ul class="list-group">
          <li class="list-group-item">
            <a href="#budget/setup/account">Account</a>
          </li>
          <li class="list-group-item">
            <a href="#budget/setup/authorities">My Authorities</a>
          </li>
        </ul>
      </div>
      <div class="col-md-8" id="panels">
        <budget-setup-authorities id="authorities"></budget-setup-authorities>
        <budget-setup-account id="account"></budget-setup-account>
      </div>
    </div>


    Change Example Budget: <select id="budgetSelect" on-change="updateExample"></select>

    <a class="btn btn-link" on-click="toggleDebug">Toggle Debug</a>
    <div class="card" id="debug" style="display:none">
      <h4>JSON (debug)</h4>
      <textarea id="json" class="form-control" style="height: 400px"></textarea>
    </div>
  </template>
</dom-module>

<script>
  Polymer({
    is : 'budget-section-setup',

    attached : function() {
      var html = '';
      for( var key in FB.examples.db ){
        html += '<option value="'+key+'" '+(this.example == key ? 'selected' : '')+'>'+key+'</option>';
      }
      for( var key in FB.examples.app ){
        html += '<option value="'+key+'" '+(this.example == key ? 'selected' : '')+'>'+key+'</option>';
      }

      this.$.budgetSelect.innerHTML = html;
    },

    onShow : function(params) {
      if( !ExpressAuth.user ) {
        this.$.noAccess.style.display = 'block';
        this.$.hasAccess.style.display = 'none';
        return;
      } else {
        this.$.noAccess.style.display = 'none';
        this.$.hasAccess.style.display = 'block';
      }

      if( params.length == 0 ) {
        return window.location = '#budget/setup/account';
      }

      if( !this.$[params[0]] ) return;
      $(this.$.panels).children().hide();

      this.$[params[0]].style.display = 'block';
      this.$[params[0]].onShow();
    },

    updateExample : function() {
      window.localStorage.setItem('budget-demo', this.$.budgetSelect.value);
      window.location.reload();
    }
  });
</script>
