<dom-module id="ahb-budget">
  <template>
    <budget-sections id="sections"></budget-sections>

    Change Example Budget: <select id="budgetSelect" on-change="updateExample"></select>
  </template>
</dom-module>

<script>
  Polymer({
    is : 'ahb-budget',

    properties : {
      example : {
        type : String
      }
    },

    attached : function() {
      var item = window.localStorage.getItem('budget-demo');
      if( item ) this.example = item;

      var html = '';
      for( var key in FB.examples.db ){
        html += '<option value="'+key+'" '+(this.example == key ? 'selected' : '')+'>'+key+'</option>';
      }
      for( var key in FB.examples.app ){
        html += '<option value="'+key+'" '+(this.example == key ? 'selected' : '')+'>'+key+'</option>';
      }
      this.$.budgetSelect.innerHTML = html;

      this.demo();
    },

    updateExample : function() {
      window.localStorage.setItem('budget-demo', this.$.budgetSelect.value);
      window.location.reload();
    },

    demo : function() {
      var appData;

      if( FB.examples.db[this.example] ) {
        appData = FB.transform(FB.examples.db[this.example]);
      } else if( FB.examples.app[this.example] ) {
        appData = FB.examples.app[this.example];
      } else {
        appData = {};
        alert('Unknown static budget: '+this.example);
        return;
      }

      window.appData = appData;

      var options = {
        noEvent : true,
        noRecalc : true
      }

      appData.materials.forEach(function(material){
        FB.materialController.add(material, options);
      });

      FB.materialController.recalc();

      FB.operationController.setFarmSize(appData.farm && appData.farm.size ? parseInt(appData.farm.size) : 1);
      appData.operations.forEach(function(operation){
        FB.operationController.add(operation, options);
      });

      FB.operationController.recalc();

      this.$.sections.setData(appData);
    }

  });
</script>
