<dom-module id="ahb-budget">
  <template>
    <budget-sections id="sections"></budget-sections>
  </template>
</dom-module>

<script>
  Polymer({
    is : 'ahb-budget',

    properties : {
      example : {
        type : String
      }
    },

    attached : function() {
      var item = window.localStorage.getItem('budget-demo');
      if( item ) this.example = item;

      this.demo();
    },

    demo : function() {
      var appData;

      if( FB.examples.db[this.example] ) {
        appData = FB.transform(FB.examples.db[this.example]);
      } else if( FB.examples.app[this.example] ) {
        appData = FB.examples.app[this.example];
      } else {
        appData = {};
        alert('Unknown static budget: '+this.example);
        return;
      }

      window.appData = appData;

      var options = {
        noEvent : true,
        noRecalc : true
      }

      appData.materials.forEach(function(material){
        FB.materialController.add(material, options);
      });

      FB.materialController.recalc();

      FB.operationController.setFarmSize(appData.farm && appData.farm.size ? parseInt(appData.farm.size) : 1);
      appData.operations.forEach(function(operation){
        FB.operationController.add(operation, options);
      });

      FB.operationController.recalc();

      this.$.sections.setData(appData);
    }

  });
</script>
