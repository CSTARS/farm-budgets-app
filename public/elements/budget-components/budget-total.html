<dom-module id="budget-total">
  <template>
    <h4 style="text-align:right">Duration: <span class="text text-primary" id="durationText"></span></h4>
    <h4 style="text-align:right">Crop Lifetime Total: <ahb-dollar-label id="totalLabel"></ahb-dollar-label></h4>
    <h4 style="text-align:right">Average Monthly Cost: <ahb-dollar-label id="average"></ahb-dollar-label></h4>
    <h4 style="text-align:right">Average Yearly Cost: <ahb-dollar-label id="averageYear"></ahb-dollar-label></h4>
  </template>
</dom-module>

<script>
  Polymer({
    is : 'budget-total',

    attached : function() {
      FB.operationController.on('total-update', this.onTotalUpdate.bind(this));
    },

    onTotalUpdate : function(e) {
      this.$.totalLabel.value = e.total;

      if( e.range.start !== null && e.range.stop !== null ) {
        var diff = e.range.stop.getTime() - e.range.start.getTime();
        var days = diff / 86400000;
        var months = Math.ceil(days / 30);
        this.$.durationText.innerHTML = months+' months <br /><small>('+this.toDateString(e.range.start)+' - '+this.toDateString(e.range.stop)+')</small>';

        this.$.average.value = e.total / months;
        this.$.averageYear.value = (e.total / months) * 12;
      } else {
        this.$.durationText.innerHTML = 'Unknown';
      }
    },

    toDateString : function(d) {
      return (d.getMonth()+1)+'/'+(d.getYear()+1900);
    }
  })
</script>
