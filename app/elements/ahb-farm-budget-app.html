<polymer-element name="ahb-farm-budget-app">
    <template>
      <style>
        .page {
          position: absolute;
          height: 100%;
          width: 100%;
          top: 0;
          left: 0;
        }
        core-animated-pages {
          height: 100%;
        }
        a[right-nav][selected] {
          box-shadow: 0 0 5px white;
        }
      </style>

        <ahb-app-layout loading="{{loading}}">
            <a right-nav href="{{hack}}#location" selected?="{{loc == 'location'}}">
              <span class="hidden-xs"><ahb-icon icon="fa-map-marker"></ahb-icon>&nbsp;Location</span>
              <span class="visible-xs"><ahb-icon icon="fa-map-marker"></ahb-icon></span>
            </a>
            <a right-nav href="{{hack}}#crop" selected?="{{loc == 'crop'}}">
              <span class="hidden-xs"><ahb-icon icon="fa-leaf"></ahb-icon>&nbsp;Crop</span>
              <span class="visible-xs"><ahb-icon icon="fa-leaf"></ahb-icon></span>
            </a>
            <a right-nav href="{{hack}}#budget" selected?="{{loc == 'budget'}}">
              <span class="hidden-xs"><ahb-icon icon="fa-usd"></ahb-icon>&nbsp;Budget</span>
              <span class="visible-xs"><ahb-icon icon="fa-usd"></ahb-icon></span>
            </a>

            <core-animated-pages id="pages" content transitions="slide-from-right" >
              <div class="page">
                <ahb-page-location id="location" 
                  location="{{location}}"
                  crops="{{crops}}">
                </ahb-page-location>
              </div> 
              <div class="page">
                <ahb-page-crop 
                  location="{{location}}" 
                  selectedCrop="{{selectedCrop}}" 
                  selectedLocality="{{selectedLocality}}" 
                  farmSize="{{farmSize}}"
                  crops="{{crops}}">
                </ahb-page-crop>
              </div>
              <div class="page">
                <ahb-page-budget 
                  location="{{location}}" 
                  selectedCrop="{{selectedCrop}}" 
                  selectedLocality="{{selectedLocality}}" 
                  farmSize="{{farmSize}}"></ahb-page-budget>
              </div>
              <div class="page">
                <ahb-page-admin schema="{{schema}}"></ahb-page-admin>
              </div>
            </core-animated-pages>
        </ahb-app-layout>

        
    </template>
    <script>
        Polymer('ahb-farm-budget-app', {
            PAGES : {
              MAP : 0,
              CROP : 1,
              RESULTS : 2,
              ADMIN : 3
            },
            loc : '',
            hack : '',
            selectedPage : 0,

            schema : null,

            ready : function() {
              $(window).on('hashchange', function(){
                this.setLocation();
              }.bind(this));

              $.get('/rest/schema', function(resp){
                this.schema = resp;
              }.bind(this));
              
              this.setLocation();
            },

            setLocation : function() {
              this.loc = window.location.hash.replace('#','').replace(/\/.*/,'');
              if( this.loc == '') this.loc = 'location';

              if( this.loc == 'location' ) {
                this.selectedPage = this.PAGES.MAP;
                this.$.pages.selected = this.selectedPage;
                setTimeout(function(){
                  this.$.location.resize();
                }.bind(this), 250);
              } else if ( this.loc == 'crop' ) {
                this.selectedPage = this.PAGES.CROP;
                this.$.pages.selected = this.selectedPage;
              } else if ( this.loc == 'budget' ) {
                this.selectedPage = this.PAGES.RESULTS;
                this.$.pages.selected = this.selectedPage;
              } else if ( this.loc == 'admin' ) {
                this.selectedPage = this.PAGES.ADMIN;
                this.$.pages.selected = this.selectedPage;
              }
            }
        });
    </script>
</polymer-element>